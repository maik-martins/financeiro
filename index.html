<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro - Fechamento Diário</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f7f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
            border-left: 4px solid #3498db;
        }
        .card.receitas {
            border-left-color: #2ecc71;
        }
        .card.despesas {
            border-left-color: #e74c3c;
        }
        .card.saldo {
            border-left-color: #9b59b6;
        }
        .valor {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .positivo {
            color: #2ecc71;
        }
        .negativo {
            color: #e74c3c;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .btn-adicionar {
            background-color: #2ecc71;
        }
        .btn-adicionar:hover {
            background-color: #27ae60;
        }
        .btn-fechamento {
            background-color: #9b59b6;
            margin-top: 20px;
        }
        .btn-fechamento:hover {
            background-color: #8e44ad;
        }
        .filtros {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .acoes {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .filtros {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Controle Financeiro - Fechamento Diário</h1>
        
        <div class="dashboard">
            <div class="card receitas">
                <h3>Total de Receitas</h3>
                <div class="valor positivo" id="total-receitas">R$ 0,00</div>
                <p>Hoje: <span id="receitas-hoje" class="positivo">R$ 0,00</span></p>
            </div>
            
            <div class="card despesas">
                <h3>Total de Despesas</h3>
                <div class="valor negativo" id="total-despesas">R$ 0,00</div>
                <p>Hoje: <span id="despesas-hoje" class="negativo">R$ 0,00</span></p>
            </div>
            
            <div class="card saldo">
                <h3>Saldo do Caixa</h3>
                <div class="valor" id="saldo-caixa">R$ 0,00</div>
                <p>Saldo do dia: <span id="saldo-diario">R$ 0,00</span></p>
            </div>
        </div>
        
        <h2>Registrar Nova Transação</h2>
        <form id="form-transacao">
            <div class="form-group">
                <label for="data">Data:</label>
                <input type="date" id="data" required>
            </div>
            
            <div class="form-group">
                <label for="descricao">Descrição:</label>
                <input type="text" id="descricao" placeholder="Ex: Venda de produtos" required>
            </div>
            
            <div class="form-group">
                <label for="categoria">Categoria:</label>
                <select id="categoria" required>
                    <option value="">Selecione uma categoria</option>
                    <optgroup label="Receitas">
                        <option value="vendas">Vendas</option>
                        <option value="servicos">Serviços</option>
                        <option value="outras_receitas">Outras Receitas</option>
                    </optgroup>
                    <optgroup label="Despesas">
                        <option value="fornecedores">Fornecedores</option>
                        <option value="funcionarios">Funcionários</option>
                        <option value="impostos">Impostos</option>
                        <option value="manutencao">Manutenção</option>
                        <option value="outras_despesas">Outras Despesas</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="form-group">
                <label for="valor">Valor (R$):</label>
                <input type="number" id="valor" step="0.01" min="0" placeholder="0,00" required>
            </div>
            
            <div class="form-group">
                <label for="tipo">Tipo:</label>
                <select id="tipo" required>
                    <option value="receita">Receita</option>
                    <option value="despesa">Despesa</option>
                </select>
            </div>
            
            <button type="submit" class="btn-adicionar">Adicionar Transação</button>
        </form>
        
        <h2>Filtros</h2>
        <div class="filtros">
            <div class="form-group">
                <label for="filtro-data">Data:</label>
                <input type="date" id="filtro-data">
            </div>
            
            <div class="form-group">
                <label for="filtro-categoria">Categoria:</label>
                <select id="filtro-categoria">
                    <option value="">Todas as categorias</option>
                    <optgroup label="Receitas">
                        <option value="vendas">Vendas</option>
                        <option value="servicos">Serviços</option>
                        <option value="outras_receitas">Outras Receitas</option>
                    </optgroup>
                    <optgroup label="Despesas">
                        <option value="fornecedores">Fornecedores</option>
                        <option value="funcionarios">Funcionários</option>
                        <option value="impostos">Impostos</option>
                        <option value="manutencao">Manutenção</option>
                        <option value="outras_despesas">Outras Despesas</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="form-group">
                <label for="filtro-tipo">Tipo:</label>
                <select id="filtro-tipo">
                    <option value="">Todos os tipos</option>
                    <option value="receita">Receita</option>
                    <option value="despesa">Despesa</option>
                </select>
            </div>
        </div>
        
        <h2>Extrato de Transações</h2>
        <table id="tabela-transacoes">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                </tr>
            </thead>
            <tbody id="corpo-tabela">
                <!-- As transações serão inseridas aqui via JavaScript -->
            </tbody>
        </table>
        
        <div class="acoes">
            <button id="btn-exportar" class="btn-fechamento">Exportar para Excel</button>
            <button id="btn-fechamento" class="btn-fechamento">Realizar Fechamento Diário</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar a planilha com dados de exemplo ou do localStorage
            let transacoes = JSON.parse(localStorage.getItem('transacoesFinanceiras')) || [];
            
            // Elementos do DOM
            const formTransacao = document.getElementById('form-transacao');
            const tabelaTransacoes = document.getElementById('tabela-transacoes');
            const corpoTabela = document.getElementById('corpo-tabela');
            const btnExportar = document.getElementById('btn-exportar');
            const btnFechamento = document.getElementById('btn-fechamento');
            
            // Elementos dos filtros
            const filtroData = document.getElementById('filtro-data');
            const filtroCategoria = document.getElementById('filtro-categoria');
            const filtroTipo = document.getElementById('filtro-tipo');
            
            // Elementos do dashboard
            const totalReceitas = document.getElementById('total-receitas');
            const totalDespesas = document.getElementById('total-despesas');
            const saldoCaixa = document.getElementById('saldo-caixa');
            const receitasHoje = document.getElementById('receitas-hoje');
            const despesasHoje = document.getElementById('despesas-hoje');
            const saldoDiario = document.getElementById('saldo-diario');
            
            // Definir data atual como padrão nos campos de data
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = hoje;
            filtroData.value = hoje;
            
            // Atualizar a exibição
            atualizarTabela();
            atualizarDashboard();
            
            // Event Listeners
            formTransacao.addEventListener('submit', function(e) {
                e.preventDefault();
                adicionarTransacao();
            });
            
            // Aplicar filtros quando os valores mudarem
            filtroData.addEventListener('change', atualizarTabela);
            filtroCategoria.addEventListener('change', atualizarTabela);
            filtroTipo.addEventListener('change', atualizarTabela);
            
            btnExportar.addEventListener('click', exportarParaExcel);
            btnFechamento.addEventListener('click', realizarFechamento);
            
            // Função para adicionar uma nova transação
            function adicionarTransacao() {
                const data = document.getElementById('data').value;
                const descricao = document.getElementById('descricao').value;
                const categoria = document.getElementById('categoria').value;
                const valor = parseFloat(document.getElementById('valor').value);
                const tipo = document.getElementById('tipo').value;
                
                const transacao = {
                    id: Date.now(), // ID único baseado no timestamp
                    data,
                    descricao,
                    categoria,
                    valor,
                    tipo
                };
                
                transacoes.push(transacao);
                salvarNoLocalStorage();
                formTransacao.reset();
                document.getElementById('data').value = hoje; // Manter a data atual
                
                atualizarTabela();
                atualizarDashboard();
            }
            
            // Função para atualizar a tabela com as transações
            function atualizarTabela() {
                // Limpar o corpo da tabela
                corpoTabela.innerHTML = '';
                
                // Obter valores dos filtros
                const dataFiltro = filtroData.value;
                const categoriaFiltro = filtroCategoria.value;
                const tipoFiltro = filtroTipo.value;
                
                // Filtrar transações
                const transacoesFiltradas = transacoes.filter(transacao => {
                    return (!dataFiltro || transacao.data === dataFiltro) &&
                           (!categoriaFiltro || transacao.categoria === categoriaFiltro) &&
                           (!tipoFiltro || transacao.tipo === tipoFiltro);
                });
                
                // Ordenar por data (mais recente primeiro)
                transacoesFiltradas.sort((a, b) => new Date(b.data) - new Date(a.data));
                
                // Adicionar transações à tabela
                if (transacoesFiltradas.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td colspan="5" style="text-align: center;">Nenhuma transação encontrada</td>`;
                    corpoTabela.appendChild(tr);
                } else {
                    transacoesFiltradas.forEach(transacao => {
                        const tr = document.createElement('tr');
                        
                        // Formatar a data para exibição
                        const dataObj = new Date(transacao.data);
                        const dataFormatada = dataObj.toLocaleDateString('pt-BR');
                        
                        // Formatar o valor para exibição
                        const valorFormatado = transacao.valor.toLocaleString('pt-BR', {
                            style: 'currency',
                            currency: 'BRL'
                        });
                        
                        tr.innerHTML = `
                            <td>${dataFormatada}</td>
                            <td>${transacao.descricao}</td>
                            <td>${formatarCategoria(transacao.categoria)}</td>
                            <td class="${transacao.tipo === 'receita' ? 'positivo' : 'negativo'}">${valorFormatado}</td>
                            <td>${transacao.tipo === 'receita' ? 'Receita' : 'Despesa'}</td>
                        `;
                        
                        corpoTabela.appendChild(tr);
                    });
                }
            }
            
            // Função para formatar a categoria para exibição
            function formatarCategoria(categoria) {
                const categorias = {
                    'vendas': 'Vendas',
                    'servicos': 'Serviços',
                    'outras_receitas': 'Outras Receitas',
                    'fornecedores': 'Fornecedores',
                    'funcionarios': 'Funcionários',
                    'impostos': 'Impostos',
                    'manutencao': 'Manutenção',
                    'outras_despesas': 'Outras Despesas'
                };
                
                return categorias[categoria] || categoria;
            }
            
            // Função para atualizar o dashboard com totais e saldos
            function atualizarDashboard() {
                // Calcular totais
                const totalReceitasValor = transacoes
                    .filter(t => t.tipo === 'receita')
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const totalDespesasValor = transacoes
                    .filter(t => t.tipo === 'despesa')
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const saldoCaixaValor = totalReceitasValor - totalDespesasValor;
                
                // Calcular valores do dia atual
                const receitasHojeValor = transacoes
                    .filter(t => t.tipo === 'receita' && t.data === hoje)
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const despesasHojeValor = transacoes
                    .filter(t => t.tipo === 'despesa' && t.data === hoje)
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const saldoDiarioValor = receitasHojeValor - despesasHojeValor;
                
                // Atualizar os elementos do DOM
                totalReceitas.textContent = totalReceitasValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                totalDespesas.textContent = totalDespesasValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                saldoCaixa.textContent = saldoCaixaValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                saldoCaixa.className = 'valor ' + (saldoCaixaValor >= 0 ? 'positivo' : 'negativo');
                
                receitasHoje.textContent = receitasHojeValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                despesasHoje.textContent = despesasHojeValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                saldoDiario.textContent = saldoDiarioValor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                saldoDiario.className = saldoDiarioValor >= 0 ? 'positivo' : 'negativo';
            }
            
            // Função para salvar no localStorage
            function salvarNoLocalStorage() {
                localStorage.setItem('transacoesFinanceiras', JSON.stringify(transacoes));
            }
            
            // Função para exportar para Excel (simulação)
            function exportarParaExcel() {
                alert('Funcionalidade de exportação para Excel será implementada aqui. Por enquanto, os dados estão armazenados no localStorage do navegador.');
            }
            
            // Função para realizar o fechamento diário
            function realizarFechamento() {
                const transacoesHoje = transacoes.filter(t => t.data === hoje);
                
                if (transacoesHoje.length === 0) {
                    alert('Não há transações para o dia de hoje.');
                    return;
                }
                
                const receitas = transacoesHoje
                    .filter(t => t.tipo === 'receita')
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const despesas = transacoesHoje
                    .filter(t => t.tipo === 'despesa')
                    .reduce((soma, t) => soma + t.valor, 0);
                
                const saldo = receitas - despesas;
                
                const resumo = `
                    FECHAMENTO DIÁRIO - ${new Date().toLocaleDateString('pt-BR')}
                    
                    Total de Receitas: ${receitas.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}
                    Total de Despesas: ${despesas.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}
                    Saldo do Dia: ${saldo.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}
                    
                    Número de Transações: ${transacoesHoje.length}
                `;
                
                alert(resumo);
            }
        });
    </script>
</body>
</html>
